---
import Layout from "../layouts/Layout.astro";

const courses = [
    "Séptimo A", 
    "Séptimo B",
    "Octavo A",
    "Octavo B",
    "Primero Medio A",
    "Primero Medio B",
    "Primero Medio C",
    "Primero Medio D",
    "Segundo Medio A",
    "Segundo Medio B",
    "Segundo Medio C",
    "Segundo Medio D",
    "Tercero Medio A", 
    "Tercero Medio B",
    "Tercero Medio C",
    "Tercero Medio D",
    "Cuarto Medio A",
    "Cuarto Medio B",
    "Cuarto Medio C",
    "Cuarto Medio D",
    "Pofesor", 
    "Personal del liceo",
]
---

<Layout title="Agrega tus datos y los de esa persona especial">
    <main class="flex flex-col w-96 justify-center items-center text-center px-0 py-20 space-y-14">
        <!-- Sección 1: Datos del remitente -->
        <section class="flex flex-col items-center justify-center space-y-10 text-balance w-full px-10">
            <div class="w-full flex flex-col justify-center items-start space-y-4">
                <h2 class="text-2xl font-semibold">Ingresa tus datos</h2>

                <div class="flex flex-col space-y-3 w-full">
                    <div class="flex flex-col justify-center items-start">
                        <label for="sender-name" class="text-left">Nombre (obligatorio)</label>
                        <input id="sender-name" type="text" class="border-2 border-gray-300 p-2 rounded-lg w-full focus:border-purple-800" placeholder="Ingresa tu nombre" required>
                    </div>

                    <div class="flex flex-col justify-center items-start">
                        <label for="sender-lastname" class="text-left">Apellido (obligatorio)</label>
                        <input id="sender-lastname" type="text" class="border-2 border-gray-300 p-2 rounded-lg w-full focus:border-purple-800" placeholder="Ingresa tu apellido" required>
                    </div>

                    <div class="flex flex-col justify-center items-start">
                        <label for="sender-nickname" class="text-left">Pseudónimo (opcional)</label>
                        <input id="sender-nickname" type="text" class="border-2 border-gray-300 p-2 rounded-lg w-full focus:border-purple-800" placeholder="Ingresa un pseudónimo (opcional)">
                    </div>

                    <div class="flex flex-col justify-center items-start">
                        <label for="sender-course" class="text-left">Curso (obligatorio)</label>
                        <select name="sender-course" id="sender-course" class="border-2 border-gray-300 p-2 rounded-lg w-full focus:border-purple-800" required>
                            <!-- Placeholder -->
                            <option value="" disabled selected class="">Selecciona tu curso</option>
                            {   courses.map((course) => (
                                <option value={course}>{course}</option>
                            ))   }
                        </select>
                    </div>

                    <div class="flex items-center space-x-2">
                        <input id="send-anonymously" type="checkbox" class="h-4 w-4 accent-purple-800">
                        <label for="send-anonymously" class="">Enviar como anónimo</label>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección 2: Datos del destinatario -->
        <section class="flex flex-col items-center justify-center space-y-10 text-balance w-full px-10">
            <div class="w-full flex flex-col justify-center items-start space-y-4">
                <h2 class="text-2xl font-semibold text-start">Datos de la persona a la que le envías</h2>

                <div class="flex flex-col space-y-3 w-full">
                    <div class="flex flex-col justify-center items-start">
                        <label for="receiver-name" class="text-left">Nombre (obligatorio)</label>
                        <input id="receiver-name" type="text" class="border-2 border-gray-300 p-2 rounded-lg w-full focus:border-purple-800" placeholder="Ingresa su nombre" required>
                    </div>

                    <div class="flex flex-col justify-center items-start">
                        <label for="receiver-lastname" class="text-left">Apellido (obligatorio)</label>
                        <input id="receiver-lastname" type="text" class="border-2 border-gray-300 p-2 rounded-lg w-full focus:border-purple-800" placeholder="Ingresa su apellido " required>
                    </div>

                    <div class="flex flex-col justify-center items-start">
                        <label for="receiver-nickname" class="text-left">Pseudónimo (opcional)</label>
                        <input id="receiver-nickname" type="text" class="border-2 border-gray-300 p-2 rounded-lg w-full focus:border-purple-800" placeholder="Ingresa su pseudónimo (opcional)">
                    </div>

                    <div class="flex flex-col justify-center items-start">
                        <label for="receiver-course" class="text-left">Curso (obligatorio)</label>
                        <select name="receiver-course" id="receiver-course" class="border-2 border-gray-300 p-2 rounded-lg w-full focus:border-purple-800" required>
                            <!-- Placeholder -->
                            <option value="" disabled selected class="">Selecciona su curso</option>
                            {   courses.map((course) => (
                                <option value={course}>{course}</option>
                            ))   }
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <!-- Botón para continuar -->
        <button>
            <a href="/order"  id="continue-button" class="sticky bg-gradient-to-r from-purple-800 via-purple-700 to-purple-600 text-white font-bold py-3 px-5 rounded-lg hidden">Continuar</a>
        </button>
    </main>
</Layout>

<style>
 
</style>

<script>
    import { formData, updateFormData } from "../stores/formStore"; 

    // Obtener los elementos
    const senderName = document.getElementById('sender-name') as HTMLInputElement;
    const senderLastname = document.getElementById('sender-lastname') as HTMLInputElement;
    const senderNickname = document.getElementById('sender-nickname') as HTMLInputElement;
    const senderCourse = document.getElementById('sender-course') as HTMLSelectElement;
    const receiverName = document.getElementById('receiver-name') as HTMLInputElement;
    const receiverLastname = document.getElementById('receiver-lastname') as HTMLInputElement;
    const receiverNickname = document.getElementById('receiver-nickname') as HTMLInputElement;
    const receiverCourse = document.getElementById('receiver-course') as HTMLSelectElement;
    const continueButton = document.getElementById('continue-button') as HTMLButtonElement;

    // Función para verificar si todos los campos obligatorios están llenos
    function checkFields() {
        if (
            senderName.value.trim() !== '' &&
            senderLastname.value.trim() !== '' &&
            senderCourse.value.trim() !== '' &&
            receiverName.value.trim() !== '' &&
            receiverLastname.value.trim() !== '' &&
            receiverCourse.value.trim() !== ''
        ) {
            continueButton.classList.remove('hidden');
        } else {
            continueButton.classList.add('hidden');
        }
    }
   
    const currentForm = formData.get();

    if (currentForm?.sender) {
        senderName.value = currentForm?.sender?.name || "";
        senderLastname.value = currentForm?.sender?.lastname || "";
        senderNickname.value = currentForm?.sender?.nickname || "";
        senderCourse.value = currentForm?.sender?.course || "";
        senderName.classList.remove('hidden');
        senderLastname.classList.remove('hidden');
        senderCourse.classList.remove('hidden');
    }

    if (currentForm?.recipient) {
        receiverName.value = currentForm?.recipient?.name || "";
        receiverLastname.value = currentForm?.recipient?.lastname || "";
        receiverNickname.value = currentForm?.recipient?.nickname || "";
        receiverCourse.value = currentForm?.recipient?.course || "";
        receiverName.classList.remove('hidden');
        receiverLastname.classList.remove('hidden');
        receiverCourse.classList.remove('hidden');
    }


    // Agregar eventos de input para verificar en tiempo real
    senderName.addEventListener('input', checkFields);
    senderLastname.addEventListener('input', checkFields);
    senderNickname.addEventListener('input', checkFields);
    senderCourse.addEventListener('input', checkFields);
    receiverName.addEventListener('input', checkFields);
    receiverLastname.addEventListener('input', checkFields);
    receiverNickname.addEventListener('input', checkFields);
    receiverCourse.addEventListener('input', checkFields);

    continueButton.addEventListener('click', () => {
        const newFormData = {
            sender: {
                name: senderName.value,
                lastname: senderLastname.value,
                nickname: senderNickname.value,
                course: senderCourse.value,
                anonymous: false
            },
            recipient: {
                name: receiverName.value,
                lastname: receiverLastname.value,
                nickname: receiverNickname.value,
                course: receiverCourse.value
            }
        };

        updateFormData(newFormData);
    });

    checkFields();
</script>
